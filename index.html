<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Dołącz do społeczności graczy</title>
<style>
/* ... (stylowanie pozostaje bez zmian) ... */
</style>
</head>
<body>

<h2>Dołącz do społeczności graczy</h2>

<div id="form">
  <input id="nick" type="text" placeholder="Twój nick (wymagany)">
  <input id="discord" type="text" placeholder="Twój Discord (opcjonalnie)">
  <button onclick="wyslij()">Dodaj</button>
  <div id="message" style="margin-top: 10px; min-height: 20px;"></div>
</div>

<div id="lista">
  <h3>Lista graczy:</h3>
  <ul id="gracze"></ul>
</div>

<div id="regulamin-box" onclick="toggleRegulamin()">Regulamin</div>
<div id="regulamin">Dołączając akceptujesz, że zbieramy dane takie jak IP, przeglądarka </div>

<div id="footer">
2025 © wituniu - <a href="https://guns.lol/wituniu" target="_blank">guns.lol/wituniu</a>
</div>

<script>
const API_URL = "https://workers-playground-super-mouse-fc07.wituniupl.workers.dev";

function showMessage(text, isError = false) {
  const messageDiv = document.getElementById("message");
  messageDiv.textContent = text;
  messageDiv.style.color = isError ? 'red' : 'green';
  setTimeout(() => { messageDiv.textContent = ''; }, 3000);
}

async function wyslij() {
  const nick = document.getElementById("nick").value.trim();
  const discord = document.getElementById("discord").value.trim();
  
  if (!nick) {
    showMessage("Podaj nick!", true);
    return;
  }

  try {
    const res = await fetch(API_URL + "/add", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({ nick, discord })
    });

    const data = await res.json();
    
    if (!res.ok) {
      showMessage(data.error || "Błąd przy dodawaniu gracza", true);
      return;
    }

    showMessage("Gracz dodany pomyślnie!");
    document.getElementById("nick").value = "";
    document.getElementById("discord").value = "";
    await pobierzListe();
    
  } catch (e) {
    console.error("Błąd:", e);
    showMessage("Nie udało się połączyć z serwerem", true);
  }
}

async function pobierzListe() {
  try {
    const res = await fetch(API_URL + "/list");
    if (!res.ok) {
      console.error("Błąd pobierania listy:", res.status);
      return;
    }
    
    const data = await res.json();
    const ul = document.getElementById("gracze");
    ul.innerHTML = "";
    
    if (data.length === 0) {
      ul.innerHTML = "<li>Brak graczy na liście</li>";
      return;
    }
    
    data.forEach(u => {
      const li = document.createElement("li");
      li.textContent = u.nick + (u.discord ? " (" + u.discord + ")" : "");
      ul.appendChild(li);
    });
  } catch (e) {
    console.error("Błąd pobierania listy:", e);
    document.getElementById("gracze").innerHTML = "<li>Błąd ładowania listy</li>";
  }
}

function toggleRegulamin() {
  const reg = document.getElementById("regulamin");
  reg.style.display = reg.style.display === "none" ? "block" : "none";
}

// Pobierz listę przy starcie
document.addEventListener('DOMContentLoaded', function() {
  pobierzListe();
});
</script>

</body>
</html>
